<!DOCTYPE html>
<html lang="{{ site.lang | default: "en" }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {%- seo -%}

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="{{ '/assets/css/theme.css' | relative_url }}">

    <!-- MapLibre GL JS CSS -->
    <link href="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.css" rel="stylesheet">

    <!-- Map CSS -->
    <link rel="stylesheet" href="{{ '/assets/css/map.css' | relative_url }}">

    <script>
      window.pageData = {
        mapCenter: {% if page.map_center %}{{ page.map_center | jsonify }}{% else %}[-9.13628, 38.72614]{% endif %},
        baseUrl: {{ site.baseurl | jsonify }},
        featuresGeoJsonUrl: {{ '/assets/data/features.geojson' | relative_url | jsonify }},
        boundaryGeoJsonUrl: {{ '/assets/boundary.geojson' | relative_url | jsonify }}
      };
    </script>
  </head>

  <body class="map-page">
    <main class="page-content d-flex d-md-block flex-column" aria-label="Content">
      <!-- Header (Mobile) / Overlay (Desktop) -->
      <header class="map-header bg-light bg-opacity-75 p-3 shadow rounded rounded-md-0 position-relative position-md-absolute">
          <div class="d-flex justify-content-start align-items-start">
            <img src="{{ '/assets/images/logo.jpg' | relative_url }}" alt="{{ site.title }} Logo" height="60" class="me-2">
            <h1 class="h4 mb-2">
                <span class="h3 fw-bold">MEPA</span>
                <small class="d-block text-body-secondary">{{ site.title }}</small>
            </h1>
          </div>
          <p class="mb-0">
              Mapa de sugest√µes para Arroios
          </p>

          <div class="mt-3 d-flex flex-wrap gap-2 align-items-center">
            <a
                href="{{ '/pontos/' | relative_url }}"
                class="btn btn-secondary text-white btn-sm shadow-sm fw-medium text-nowrap"
            >
                Todos os pontos
            </a>
            <button
                class="btn btn-outline-primary btn-sm shadow-sm fw-medium text-nowrap"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#filterPanel"
                aria-expanded="false"
                aria-controls="filterPanel"
            >
                <i class="bi bi-funnel"></i> Filtros
            </button>
          </div>

          <!-- Filter Panel -->
          <div class="collapse mt-3" id="filterPanel">
            <div class="card shadow-sm">
              <div class="card-body p-3">
                <div class="row g-3">
                  <div class="col-md-4 mb-3 mb-md-0">
                    <label for="temaFilter" class="form-label small fw-medium text-muted mb-1">Tema</label>
                    <select class="form-select form-select-sm" id="temaFilter">
                      <option value="">Todos os temas</option>
                    </select>
                  </div>
                  <div class="col-md-4 mb-3 mb-md-0">
                    <label for="pelouroFilter" class="form-label small fw-medium text-muted mb-1">Pelouro</label>
                    <select class="form-select form-select-sm" id="pelouroFilter">
                      <option value="">Todos os pelouros</option>
                    </select>
                  </div>
                  <div class="col-md-4 mb-3 mb-md-0">
                    <label for="estadoFilter" class="form-label small fw-medium text-muted mb-1">Estado</label>
                    <select class="form-select form-select-sm" id="estadoFilter">
                      <option value="">Todos os estados</option>
                    </select>
                  </div>
                </div>
                <div class="mt-3 d-flex flex-wrap gap-2 justify-content-end align-items-center">
                  <button type="button" class="btn btn-outline-secondary btn-sm text-nowrap" id="clearFilters">
                    <i class="bi bi-x-circle"></i> Limpar
                  </button>
                  <span class="badge bg-primary align-self-center" id="activeFiltersCount" style="display: none; font-size: 0.75rem;">0 filtros ativos</span>
                </div>
              </div>
            </div>
          </div>

      </header>

      <!-- Map Container -->
      <div class="map-container flex-grow-1 flex-md-grow-0">
        <div id="map"></div>
      </div>

      <!-- Side Panel -->
      <div class="offcanvas offcanvas-end" tabindex="-1" id="detailsPanel" aria-labelledby="detailsPanelLabel">
        <div class="offcanvas-header bg-light border-bottom">
          <h5 class="offcanvas-title fw-semibold text-dark" id="detailsPanelLabel">
            Detalhes
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body bg-white" id="panelBody">
          <!-- Content will be loaded from page templates -->
        </div>
      </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@5.7.0/dist/maplibre-gl.js"></script>

    <!-- Map JS -->
    <script src="{{ '/assets/js/map.js' | relative_url }}"></script>
  </body>
</html>
