---
layout: default
---

<div class="container my-5">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4">Pontos</h1>
            <p class="lead">
                Explore todos os pontos identificados na nossa cidade
            </p>
        </div>
    </div>

    <!-- Filtros -->
    <div class="row mb-4">
        <div class="col">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="fas fa-filter me-2"></i>Filtros
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="filtroTema" class="form-label"
                                >Tema</label
                            >
                            <select class="form-select" id="filtroTema">
                                <option value="">Todos os temas</option>
                                {% for tema in page.temas %}
                                <option value="{{ tema }}">{{ tema }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filtroPelouro" class="form-label"
                                >Pelouro</label
                            >
                            <select class="form-select" id="filtroPelouro">
                                <option value="">Todos os pelouros</option>
                                {% for pelouro in page.pelouros %}
                                <option value="{{ pelouro }}">
                                    {{ pelouro }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filtroEstado" class="form-label"
                                >Estado</label
                            >
                            <select class="form-select" id="filtroEstado">
                                <option value="">Todos os estados</option>
                                {% for estado in page.estados %}
                                <option value="{{ estado }}">
                                    {{ estado }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <button
                                type="button"
                                class="btn btn-secondary btn-sm"
                                id="limparFiltros"
                            >
                                <i class="fas fa-times me-1"></i>Limpar Filtros
                            </button>
                            <span
                                class="ms-3 text-muted"
                                id="contadorPontos"
                            ></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="pontosContainer">
        {% assign pontos = site.pages | where_exp: "page", "page.path contains
        'pontos/'" | where_exp: "page", "page.slug != nil" | sort: "nome" %} {%
        for ponto in pontos %}
        <div
            class="col-md-6 col-lg-4 mb-4 ponto-card"
            data-tema="{{ ponto.tema }}"
            data-pelouro="{{ ponto.pelouro }}"
            data-estado="{{ ponto.estado }}"
        >
            <div class="card h-100 shadow-sm">
                {% if ponto.imagens and ponto.imagens.size > 0 %}
                <img
                    src="{{ ponto.imagens[0] | relative_url }}"
                    class="card-img-top"
                    alt="{{ ponto.nome }}"
                    style="height: 200px; object-fit: cover"
                />
                {% else %}
                <div
                    class="card-img-top bg-light d-flex align-items-center justify-content-center"
                    style="height: 200px"
                >
                    <i class="fas fa-map-marker-alt fa-3x text-muted"></i>
                </div>
                {% endif %}

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ ponto.nome }}</h5>
                    <p class="card-text flex-grow-1">
                        {{ ponto.descricao | truncatewords: 20 }}
                    </p>

                    <div class="mt-auto">
                        <div class="row mb-2">
                            <div class="col-12">
                                <small class="text-muted">
                                    <strong>Pelouro:</strong> {{ ponto.pelouro
                                    }}<br />
                                    <strong>Tema:</strong> {{ ponto.tema }}
                                </small>
                            </div>
                        </div>

                        <div
                            class="d-flex justify-content-between align-items-center"
                        >
                            {% case ponto.estado %} {% when 'Por resolver' %}
                            <span class="badge bg-warning text-dark"
                                >{{ ponto.estado }}</span
                            >
                            {% when 'Em progresso' %}
                            <span class="badge bg-info text-dark"
                                >{{ ponto.estado }}</span
                            >
                            {% when 'Resolvido' %}
                            <span class="badge bg-success"
                                >{{ ponto.estado }}</span
                            >
                            {% else %}
                            <span class="badge bg-secondary"
                                >{{ ponto.estado }}</span
                            >
                            {% endcase %}

                            <a
                                href="{{ ponto.url | relative_url }}"
                                class="btn btn-primary btn-sm"
                                >Ver Detalhes</a
                            >
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if pontos.size == 0 %}
    <div class="row">
        <div class="col text-center">
            <div class="alert alert-info" role="alert">
                <h4 class="alert-heading">Nenhum ponto encontrado</h4>
                <p>Ainda não há pontos cadastrados no sistema.</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Mensagem de filtros sem resultados -->
    <div class="row" id="semResultados" style="display: none">
        <div class="col text-center">
            <div class="alert alert-warning" role="alert">
                <h4 class="alert-heading">
                    <i class="fas fa-search me-2"></i>Nenhum ponto encontrado
                </h4>
                <p>Não há pontos que correspondam aos filtros selecionados.</p>
                <button
                    type="button"
                    class="btn btn-outline-primary"
                    id="limparFiltrosMsg"
                >
                    <i class="fas fa-times me-1"></i>Limpar Filtros
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const filtroTema = document.getElementById("filtroTema");
        const filtroPelouro = document.getElementById("filtroPelouro");
        const filtroEstado = document.getElementById("filtroEstado");
        const limparFiltrosBtn = document.getElementById("limparFiltros");
        const limparFiltrosMsgBtn = document.getElementById("limparFiltrosMsg");
        const contadorPontos = document.getElementById("contadorPontos");
        const semResultados = document.getElementById("semResultados");
        const pontosCards = document.querySelectorAll(".ponto-card");

        // Função para obter parâmetros da URL
        function obterParametrosURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                tema: urlParams.get("tema") || "",
                pelouro: urlParams.get("pelouro") || "",
                estado: urlParams.get("estado") || "",
            };
        }

        // Função para atualizar a URL com os filtros atuais
        function atualizarURL() {
            const params = new URLSearchParams();

            if (filtroTema.value) {
                params.set("tema", filtroTema.value);
            }
            if (filtroPelouro.value) {
                params.set("pelouro", filtroPelouro.value);
            }
            if (filtroEstado.value) {
                params.set("estado", filtroEstado.value);
            }

            const newUrl = params.toString()
                ? `${window.location.pathname}?${params.toString()}`
                : window.location.pathname;

            // Atualizar URL sem recarregar a página
            window.history.replaceState({}, "", newUrl);
        }

        // Função para aplicar filtros da URL aos elementos select
        function aplicarFiltrosURL() {
            const parametros = obterParametrosURL();

            if (parametros.tema) {
                filtroTema.value = parametros.tema;
            }
            if (parametros.pelouro) {
                filtroPelouro.value = parametros.pelouro;
            }
            if (parametros.estado) {
                filtroEstado.value = parametros.estado;
            }
        }

        function aplicarFiltros() {
            const temaValue = filtroTema.value.toLowerCase();
            const pelouroValue = filtroPelouro.value.toLowerCase();
            const estadoValue = filtroEstado.value.toLowerCase();

            let pontosVisiveis = 0;

            pontosCards.forEach((card) => {
                const tema = card.dataset.tema
                    ? card.dataset.tema.toLowerCase()
                    : "";
                const pelouro = card.dataset.pelouro
                    ? card.dataset.pelouro.toLowerCase()
                    : "";
                const estado = card.dataset.estado
                    ? card.dataset.estado.toLowerCase()
                    : "";

                const temaMatch = !temaValue || tema === temaValue;
                const pelouroMatch = !pelouroValue || pelouro === pelouroValue;
                const estadoMatch = !estadoValue || estado === estadoValue;

                if (temaMatch && pelouroMatch && estadoMatch) {
                    card.style.display = "block";
                    pontosVisiveis++;
                } else {
                    card.style.display = "none";
                }
            });

            // Atualizar contador
            if (temaValue || pelouroValue || estadoValue) {
                contadorPontos.textContent = `${pontosVisiveis} ponto${pontosVisiveis !== 1 ? "s" : ""} encontrado${pontosVisiveis !== 1 ? "s" : ""}`;
            } else {
                contadorPontos.textContent = `${pontosCards.length} ponto${pontosCards.length !== 1 ? "s" : ""} no total`;
            }

            // Mostrar/esconder mensagem sem resultados
            if (
                pontosVisiveis === 0 &&
                (temaValue || pelouroValue || estadoValue)
            ) {
                semResultados.style.display = "block";
            } else {
                semResultados.style.display = "none";
            }

            // Atualizar URL após aplicar filtros
            atualizarURL();
        }

        function limparFiltros() {
            filtroTema.value = "";
            filtroPelouro.value = "";
            filtroEstado.value = "";
            aplicarFiltros();
        }

        // Event listeners
        filtroTema.addEventListener("change", aplicarFiltros);
        filtroPelouro.addEventListener("change", aplicarFiltros);
        filtroEstado.addEventListener("change", aplicarFiltros);
        limparFiltrosBtn.addEventListener("click", limparFiltros);
        limparFiltrosMsgBtn.addEventListener("click", limparFiltros);

        // Aplicar filtros da URL primeiro, depois aplicar filtros e mostrar contador
        aplicarFiltrosURL();
        aplicarFiltros();
    });
</script>
